# 米度物联网配置指令

## 修订记录

| 版本号 | 日期       | 变更类型 | 修改人 | 变更说明 |
|--------|------------|----------|--------|----------|
| V1.0   | 2025.08.04 | A        | 宫贺   | 添加指令 |

## 目录

- [米度物联网配置指令](#米度物联网配置指令)
  - [修订记录](#修订记录)
  - [目录](#目录)
  - [1. 通信规约](#1-通信规约)
    - [1.1 设备和配置工具之间的交换认证](#11-设备和配置工具之间的交换认证)
    - [1.2 指令内容及响应格式](#12-指令内容及响应格式)
      - [查询指令](#查询指令)
      - [配置指令](#配置指令)
      - [错误说明](#错误说明)
  - [2. 指令设计](#2-指令设计)
    - [2.1 通用物联网指令](#21-通用物联网指令)
      - [2.1.1 查询设备状态信息](#211-查询设备状态信息)
        - [2.1.1.1 M50 返回数据](#2111-m50-返回数据)
        - [2.1.1.2 M20 返回数据](#2112-m20-返回数据)
        - [2.1.1.3 M10 返回数据](#2113-m10-返回数据)
      - [2.1.2 设备工作模式](#212-设备工作模式)
        - [2.1.2.1 查询数据](#2121-查询数据)
        - [2.1.2.2 配置数据](#2122-配置数据)
      


## 1. 通信规约

### 1.1 设备和配置工具之间的交换认证

设备与配置工具之间使用 apikey 作为鉴权信息。建立物理连接后，进入指令交互模式，设备将比对 apikey。

- 默认 apikey：`b12aac6b-0bd2-4a01-80fd-97fe4f5d4ff9`
- 注册后设备将更新 apikey
- 工具连接前应从平台获取 apikey，失败时用默认值

### 1.2 指令内容及响应格式

#### 查询指令

- 指令格式：
  ```
  $cmd=xxx&apikey=xxx&msgid=xxx
  ```
- 应答成功：
  ```
  $cmd=xxx&paramA=xxx&paramB=xxx&apikey=xxx&msgid=xxx
  ```
- 应答失败：
  ```
  $cmd=xxx&result=fail&reason=string&apikey=xxx&msgid=xxx
  ```

#### 配置指令

- 指令格式：
  ```
  $cmd=xxx&paramA=xxx&paramB=xxx&apikey=xxx&msgid=xxx
  ```
- 应答成功：
  ```
  $cmd=xxx&result=succ&apikey=xxx&msgid=xxx
  ```
- 应答失败：
  ```
  $cmd=xxx&result=fail&reason=string&apikey=xxx&msgid=xxx
  ```

#### 错误说明

- 指令错误：`reason=unsupported`
- 参数错误：`reason=xxx-param_invalid`（仅判断首个出错参数）
- apikey 错误：`reason=apikey_invalid`

**注意事项：**

- `apikey`：防止恶意推送消息
- `msgid`：保证消息唯一性，响应需带上
- 特殊字符转义：`$` → `%24`，`=` → `%3D`，`&` → `%26`，`%` → `%25`
- 最大长度为 2000 字符
- 参数值为空表示清空该配置项（暂不支持）


## 2. 指令设计

### 2.1 通用物联网指令

#### 2.1.1 查询设备状态信息

- 指令格式：
  ```
  $cmd=getstatus&apikey=123456&msgid=123456
  ```

##### 2.1.1.1 M50 返回数据
- 应答成功：
  ```
  $cmd=getstatus&state={"device_type":"M50","sn":"1110008GM5","device_status":-3,"hw_version":"4.0","sw_version":"4.0.1-M1-25080117","sw_date":"Aug  1 2025 18:00:17","boot_code":"1419","boot_time":"2025-08-01 18:28:18","run_time":231222,"total_run_time":1100119,"work_mode":2,"rept_mode":0,"cap_freq":15,"emmc_free":14.384,"emmc_storage":14.833,"mobile_net":1,"net_type":"4G","operator":"CMCC","csq":-53,"4g_signal":-53,"imsi":"460088629701837","ccid":"898608162624D0441837","imei":"869667072449545","location":"121.594756,31.212485,43.293600","radio_use":1,"bt_connected":0,"dataCenterStatus":"0,0,1,1","dataCenterPlatform":"3,7,2,13","ext_power_volt":12.0,"solar_volt":0.0,"battery_volt":8.1,"temp":30.5,"humidity":33.3,"battery":[{"battery_volt":0.0,"battery_cap":0.0,"battery_status":-1,"battery_temp":0.0,"battery_health":1.0},{"battery_volt":8.1,"battery_cap":95.0,"battery_status":0,"battery_temp":27.6,"battery_health":100.0}],"gnss":"OK","sd":"OK","scl":"OK","4g":"OK","bt":"OK","lora":"FAIL","sht21":"OK","simCard":"FAIL","sim_status":"OK","sensor_errno":[{"errno":0,"sensor_id":"103_1"},{"errno":-2,"sensor_id":"106_1"}],"attach_data":[{"key":"hw_version","value":"1.5"},{"key":"moudleupgrade","value":"0,0"},{"key":"rtkstatus","value":"1,8,100.0,100.0,base-not-ready,ntrip,recv_rtcm,100.0"}],"time":"2025-08-04 10:42:26","rtkCalcSta":"OK","Z_Angle":89.94,"X_Angle":0.07,"Y_Angle":0.06,"starNum":39,"gnssCard":1,"product_time":"20250120","worktime":231222,"currentMode":"ONLINE_WORK_MODE","gnssCalcMode":1,"scl_read_err_flag":0,"sysrebootcnt":35,"cors_use":0,"net_mode":0,"test_malloc_cnt":123}&apikey=5f062426-41c8-451b-aeed-bb8de2b536cb&msgid=ad154454-9e98-4840-a45d-394062dcb6f9  
  ```

**字段说明：**

| 字段名 | 说明 | 示例 | 备注 |
| --- | --- | --- | --- |
| device_type | 设备型号 | M50 | |
| sn | 设备SN | 2481006GM5 | |
| device_status | 设备状态 | 0 | 0：正常 -2：告警 -3：异常 |
| sw_version | 固件版本 | 1.0.0_M1 | |
| sw_date | 固件日期 | 2024.09.14 | |
| boot_code | 启动代码 | 2000 | |
| boot_time | 启动时间 | 2024.08.29 17: 58: 32 | |
| run_time | 本次运行时间 | 55832 | 单位：秒 |
| total_run_time | 累计运行时间 | 55832 | 单位：秒 |
| work_mode | 工作模式 | 1 | 1：基站  2：测站  3：PPP-B2b  4：CORS接入 |
| rept_mode | 上报模式 | 1 | 0：常在线  1：低功耗  2：自适应 |
| net_mode  | 网络模式 | 1 | 0：4G传输  1：电台传输  2：自动 |
| capture_freq | 抓拍频率 | 120 | 单位：分钟/次 |
| emmc_free | 可用空间 | 14.6GB | |
| emmc_storage | 总空间 | 15.6GB | |
| mobile_net | 移动网络（连接与否） | 1 | 0：未连接 1：已连接 |
| net_type | 网络类型 | 4G | |
| operator | 运营商 | CMCC | CMCC(中国移动)、CU(中国联通)、CT(中国电信) |
| csq | 信号强度 | -51 | |
| imsi | IMEI | 865019074780812 | |
| ccid | CCID | 898608162623D0102610 | |
| location | 位置信息 | 10925.709961E, 3111.139160N, 33.0862 | 经度、维度、高程 |
| radio_use | 电台（启用/未启用） | 0 | 0：未启用  1：启用 |
| bt_connected | 蓝牙（连接/未连接） | 0 | 0：未连接 1：已连接 |
| cors_use | CORS（启用/未启用） | 0 | 0：未启用 1：已启用 |
| dataCenterStatus | 数据中心连接状态 | "1,0,0,0" | 0：未开启 1：已连接 2：未连接 |
| dataCenterPlatform | 连接平台类型 | "2,7,0,0" | 0：地大平台 1：中移物联平台 2：米度物联平台 3：地大平台2 4：河南水利平台 5：米度水文平台 6：AMS解算平台 7：重庆地灾平台 8：广东水利平台 9：广西水文平台 10：湖北水文平台 11：湖北生态流量平台 |
| ext_power_volt | 外部电压 | 18.6 | |
| solar_volt | 太阳能电压 | 18.5 | |
| temp | 内部温度 | 32.5 | |
| humidity | 内部湿度 | 45 | 表示百分比 |
| battery_volt | 电池电压 | 8.5 | |
| battery_cap | 电池电量 | 0-100 | 表示电量百分比 |
| battery_status | 电池状态 | 1 | 0：放电中  1：充电中  2：空闲 -1：异常 |
| battery_temp | 电池温度 | 32.5 | |
| battery_health | 电池健康度 | 0-100 | 表示百分比 |
| gnss | GNSS模块 | OK | OK：正常 FAIL：异常 |
| scl | 加速度计 | OK | OK：正常 FAIL：异常 |
| 4g | 4G模块 | OK | OK：正常 FAIL：异常 |
| sim_status | SIM卡 | OK | OK：正常 FAIL：异常 |
| ble | 蓝牙模块 | OK | OK：正常 FAIL：异常 |
| lora | 电台模块 | OK | OK：正常 FAIL：异常 |
| emmc | 存储卡 | FAIL | OK：正常 FAIL：异常 |
| sht21 | 温湿度模块 | FAIL | OK：正常 FAIL：异常 |


##### 2.1.1.2 M20 返回数据

- 应答成功：
  ```
  $cmd=getstatus&state={"ext_power_volt":11.7,"inner_power_volt":1.1,"temp":27.9,"humidity":42.2,"temp_out":0.0,"humidity_out":0.0,"4g_signal":-63,"on_4g":true,"bd_signal":0.0,"hw_version":"1.5","sw_version":"2.0.4-M1-25073109","location":"121.594727, 31.212461","sensor_errno":[{"errno":0,"sensor_id":"103_1"},{"errno":0,"sensor_id":"106_1"}],"attach_data":[{"key":"hw_version","value":"1.5"},{"key":"moudleupgrade","value":"0,0"},{"key":"rtkstatus","value":"1,2,100.0,99.6,succ,recv_rtcm,100.0,0,0,131"},{"key":"sloarCtrlStatus","value":"-3"},{"key":"inTHMeterStatus","value":"-3"}],"solar_volt":0.0,"battery_volt":0.0,"supply_power":0.0,"consume_power":0.0,"time":"2025-08-04 10:47:10","rtkCalcSta":"OK","onlinetime":"235952","solar_current":0.0,"battery_current":0.0,"IMEI":"867409076190441","IMSI":"460240082813198","CCID":"89860838262480013198","work_current":0.0,"volt_percent":100.0,"Z_Angle":89.12,"X_Angle":0.19,"Y_Angle":-0.91,"SN":"1310001GM2","emmc_storage":"29032.20,29820.00MB","dataCenter1":0,"dataCenter2":0,"dataCenter3":1,"dataCenter4":1,"starNum":20,"gpsCard":"0","self_check":"emmc:1,4g:1,rtc:1,solar485:0,bt:1,gnss:1,radio:0,mems:1,product_time:20240311","worktime":235952,"workMode":2,"gnssCalcMode":1,"btLinkSta":0}&apikey=dbd80fc4-1afe-455b-854e-5eb40deacd14&msgid=573888f4-9683-41d3-8332-97c263ca7a33
  ```

**字段说明：**

| 字段名 | 说明 | 示例 | 备注 |
| --- | --- | --- | --- |
| ext_power_volt | 外部电压 | 11.7 | |
| inner_power_volt | 内部电压 | 1.1 | |
| temp | 内部温度 | 27.9 | |
| humidity | 内部湿度 | 42.2 | |
| temp_out | 外部温度 | 0.0 | |
| humidity_out | 外部湿度 | 0.0 | |
| 4g_signal | 4G信号强度 | -63 | |
| on_4g | 4G连接状态 | true | |
| bd_signal | 蓝牙信号强度 | 0.0 | |
| hw_version | 硬件版本 | 1.5 | |
| sw_version | 软件版本 | 2.0.4-M1-25073109 | |
| location | 位置信息 | 121.594727, 31.212461 | 经度、维度 |
| sensor_errno | 传感器错误 | [{"errno":0,"sensor_id":"103_1"},{"errno":0,"sensor_id":"106_1"}] | 传感器ID、错误码 |
| attach_data | 附加数据 | [{"key":"hw_version","value":"1.5"},{"key":"moudleupgrade","value":"0,0"},{"key":"rtkstatus","value":"1,2,100.0,99.6,succ,recv_rtcm,100.0,0,0,131"},{"key":"sloarCtrlStatus","value":"-3"},{"key":"inTHMeterStatus","value":"-3"}] | 键值对 |
| solar_volt | 太阳能电压 | 0.0 | |
| battery_volt | 电池电压 | 0.0 | |
| supply_power | 供电功率 | 0.0 | |
| consume_power | 耗电功率 | 0.0 | |
| time | 时间 | 2025-08-04 10:47:10 | |
| rtkCalcSta | RTK计算状态 | OK | OK：正常 FAIL：异常 |
| onlinetime | 在线时间 | 235952 | 单位：秒 |
| solar_current | 太阳能电流 | 0.0 | |
| battery_current | 电池电流 | 0.0 | |
| IMEI | IMEI | 867409076190441 | |
| IMSI | IMSI | 460240082813198 | |
| CCID | CCID | 89860838262480013198 | |
| work_current | 工作电流 | 0.0 | |
| volt_percent | 电压百分比 | 100.0 | |
| Z_Angle | Z轴角度 | 89.12 | |
| X_Angle | X轴角度 | 0.19 | |
| Y_Angle | Y轴角度 | -0.91 | |
| SN | SN | 1310001GM2 | |
| emmc_storage | 存储空间 | 29032.20,29820.00MB | |
| dataCenter1 | 数据中心1 | 0 | |
| dataCenter2 | 数据中心2 | 0 | |
| dataCenter3 | 数据中心3 | 1 | |
| dataCenter4 | 数据中心4 | 1 | |
| starNum | 星数 | 20 | |
| gpsCard | GPS卡 | 0 | |
| self_check | 自检 | emmc:1,4g:1,rtc:1,solar485:0,bt:1,gnss:1,radio:0,mems:1,product_time:20240311 | |
| workMode | 工作模式 | 2 | 1：基站  2：测站  3：PPP-B2b  4：CORS接入 |
| gnssCalcMode | GNSS计算模式 | 1 | 0：RTK  1：PPP |
| btLinkSta | 蓝牙连接状态 | 0 | 0：未连接 1：已连接 |



##### 2.1.1.3 M10 返回数据

- 应答成功：
  ```

  ```





#### 2.1.2 设备工作模式

##### 2.1.2.1 查询数据
- 指令格式：
  ```
  $cmd=md_cfgrtkparam&method=0&apikey=95b00bdc-4ecd-4772-aaca-17fd7079decd&msgid=08bbe4
  ```

- 应答成功：
  ```
  $cmd=md_cfgrtkparam&method=0&mode=2&reportMode=2&networkMode=2&alarmSwitch=0&gateAngleVal1=16.000&gateDevVal1=800.000&gateDevVal2=400.000&gateDevVal3=200.000&gateDevVal4=100.000&apikey=95b00bdc-4ecd-4772-aaca-17fd7079decd&msgid=08bbe4
  ```

- 应答失败：
  ```
   $cmd=md_cfgrtkparam&method=0&result=fail&reason=string&apikey=123456&msgid=123456
  ```

##### 2.1.2.2 配置数据

- 指令格式：
  ```
   $cmd=md_cfgrtkparam&method=1&mode=2&reportMode=2&networkMode=2&alarmSwitch=0&gateAngleVal1=16.000&gateDevVal1=800.000&gateDevVal2=400.000&gateDevVal3=200.000&gateDevVal4=100.000&apikey=95b00bdc-4ecd-4772-aaca-17fd7079decd&msgid=08bbe4
  ```

- 应答成功：
  ```
  $cmd=md_cfgrtkparam&method=1&result=succ&apikey=95b00bdc-4ecd-4772-aaca-17fd7079decd&msgid=93e574
  ```

- 应答失败：
  ```
  $cmd=md_cfgrtkparam&method=1&result=fail&reason=string&apikey=123456&msgid=123456
  ```

**字段说明：**

| 字段名 | 说明 | 示例 | 备注 |
| --- | --- | --- | --- |
| mode | 工作模式 | 2 | 1：基站  2：测站  3：PPP-B2b  4：CORS接入 |
| reportMode | 上报模式 | 2 | 0：常在线  1：低功耗  2：自适应 |
| networkMode | 网络模式 | 2 | 0：4G传输  1：电台传输  2：自动 |
| alarmSwitch | 四级报警开关 | 0 | 0:关闭 1:打开 |
| gateAngleVal1 | MEMS 触发阈值 | 18.1 | 单位：度 |
| gateDevVal1 | 位移报警一级阈值 | 300 | 单位：毫米 |
| gateDevVal2 | 位移报警二级阈值 | 300 | 单位：毫米 |
| gateDevVal3 | 位移报警三级阈值 | 300 | 单位：毫米 |
| gateDevVal4 | 位移报警四级阈值 | 300 | 单位：毫米 |


