---
NotionID-ob2notion: 1a7038ef-a6c2-8140-8e16-e0550f1a973d
link-ob2notion: https://www.notion.so/MR702-1a7038efa6c281408e16e0550f1a973d
---

##  报警设置页面
### 指令字段说明
| 参数 | 说明 |示例 |备注 |
| - | - |- |- |
| index | 模块索引 | 0 | 0：雨量，1：水位|
| switch | 报警开关 | 0 |0：关闭，1：打开 |
| relay | 继电器开关 | 1 |0：关闭，1：打开 |
| holdtime | 报警保持时间 | 1 | 数值≥1，单位：分钟 |
| gaptime | 报警间隔时间 | 1 | 数值≥1，单位：分钟 |
| cleargaptime | 报警清除间隔时间 | 1 | 数值≥1，单位：分钟 |
| warnlevel | 报警级别 | 100,200,300,99900 | 单位：雨量：毫米，水位：米，App 需要将输入值扩大100倍写入指令 |
| voiceindex1 | 等级1语音报警发送指令 | 14,A6030900090001040300A103390E |格式：字节长度,内容 |
| voiceindex2 | 等级2语音报警发送指令 | 14,A6030900090001040300A20339FE |格式：字节长度,内容 |
| voiceindex3 | 等级3语音报警发送指令 | 14,A6030900090001040300A303386E |格式：字节长度,内容 |
| voiceindex4 | 等级4语音报警发送指令 | 14,A6030900090001040300A4033A5E |格式：字节长度,内容 |
| voiceindex5 | 消警发送指令 | 14,A60309000900010403000003409E |格式：字节长度,内容 |
| respindex1 | 等级1语音报警应答指令 | 13,A603080009000104030098D9FB |格式：字节长度,语音内容 |
| respindex2 | 等级2语音报警应答指令 | 13,A603080009000104030098D9FB |格式：字节长度,语音内容 |
| respindex3 | 等级3语音报警应答指令 | 13,A603080009000104030098D9FB |格式：字节长度,语音内容 |
| respindex4 | 等级4语音报警应答指令 | 13,A603080009000104030098D9FB |格式：字节长度,语音内容 |
| respindex5 | 消警应答指令 | 13,A603080009000104030098D9FB |格式：字节长度,语音内容 |

### 查询报警信息
```
//雨量：index=0
发送：$cmd=md_getalarmmodule&index=0    
应答：$cmd=md_getalarmmodule&index=0&switch=0&relay=1&holdtime=1&gaptime=60&cleargaptime=60&warnlevel=100,200,300,99999&voiceindex1=14,A6030900090001040300A103390E&voiceindex2=14,A6030900090001040300A20339FE&voiceindex3=14,A6030900090001040300A303386E&voiceindex4=14,A6030900090001040300A4033A5E&voiceindex5=14,A60309000900010403000003409E&respindex1=13,A603080009000104030098D9FB&respindex2=13,A603080009000104030098D9FB&respindex3=13,A603080009000104030098D9FB&respindex4=13,A603080009000104030098D9FB&respindex5=13,A603080009000104030098D9FB

//水位：index=1
发送：$cmd=md_getalarmmodule&index=1    
应答：$cmd=md_getalarmmodule&index=1&switch=0&relay=1&holdtime=1&gaptime=60&cleargaptime=60&warnlevel=1000,2000,3000,99999&voiceindex1=14,A6030900090001040300A103390E&voiceindex2=14,A6030900090001040300A20339FE&voiceindex3=14,A6030900090001040300A303386E&voiceindex4=14,A6030900090001040300A4033A5E&voiceindex5=14,A60309000900010403000003409E&respindex1=13,A603080009000104030098D9FB&respindex2=13,A603080009000104030098D9FB&respindex3=13,A603080009000104030098D9FB&respindex4=13,A603080009000104030098D9FB&respindex5=13,A603080009000104030098D9FB
```

### 设置报警参数
```
//雨量：index=0
发送：$cmd=md_setalarmmodule&index=0&switch=0&relay=1&holdtime=1&gaptime=60&cleargaptime=60&warnlevel=100,200,300,99900&voiceindex1=14,A6030900090001040300A103390E&voiceindex2=14,A6030900090001040300A20339FE&voiceindex3=14,A6030900090001040300A303386E&voiceindex4=14,A6030900090001040300A4033A5E&respindex1=13,A603080009000104030098D9FB&respindex2=13,A603080009000104030098D9FB&respindex3=13,A603080009000104030098D9FB&respindex4=13,A603080009000104030098D9FB&respindex5=13,A603080009000104030098D9FB
应答：$cmd=md_setalarmmodule&index=0&result=succ

//水位：index=1
发送：$cmd=md_setalarmmodule&index=1&switch=0&relay=1&holdtime=1&gaptime=60&cleargaptime=60&warnlevel=1000,2000,3000,99900&voiceindex1=14,A6030900090001040300A103390E&voiceindex2=14,A6030900090001040300A20339FE&voiceindex3=14,A6030900090001040300A303386E&voiceindex4=14,A6030900090001040300A4033A5E&respindex1=13,A603080009000104030098D9FB&respindex2=13,A603080009000104030098D9FB&respindex3=13,A603080009000104030098D9FB&respindex4=13,A603080009000104030098D9FB&respindex5=13,A603080009000104030098D9FB
应答：$cmd=md_setalarmmodule&index=1&result=succ
```

### 注意
1. 从 respindex1= 开始的部分为固定内容，不做配置，App 自动加上就行。雨量和水位都一样；

2. warnlevel 需要 App 用逗号隔开写入指令，按照1-4级的顺序；

3. voiceindex1-voiceindex4 字段中，14为固定字节数，逗号后为报警指令，A6030900090001040300A103390E，此标 A1 为语音编号，03 为报警次数，都需要进行设置，输出时是按照十进制，App 需要转成16进制并进行 **CRC-16** 校验后组成完成报警指令。
   
4. 内容参数均通过 $cmd=md_getalarmmodule&index=value 去获取，不用进行默认


##  RS485-1 接口主页面
### 采集控制指令字段说明
| 参数 | 说明 |示例 |备注 |
| - | - |- |- |
| collfreq | 采集频率 | 0 | 单位：毫秒 |
| collcycle | 采集周期 | 0 | 单位：分钟 |
| collround | 采集次数 | 0 | |
| noresp | 超时次数/无应答次数 | 3 |  |
| powerontimes | 延时时间 | 10 | 单位：秒|

### 查询采集控制信息
```
发送：$cmd=md_get485port1_coll   
应答：$cmd=md_get485port1_coll&collcycle=0&noresp=3&collround=0&collfreq=0&powerontimes=10
```

### 设置采集控制参数
```
发送：$cmd=md_set485port1_coll&collcycle=0&noresp=3&collround=0&collfreq=0&powerontimes=10
应答：$cmd=md_set485port1_coll&result=succ
```

### 查询传感器列表状态指令字段说明
| 参数 | 说明 |示例 |备注 |
| - | - |- |- |
| index | 索引 | 0 | 0：获取全部，1：获取第一个传感器|
| model | 物模型加地址 | 227_1 | 217 为物模型，1 为地址 |
| sta | 状态 | -3 | 0：接入 |

### 查询传感器列表状态
```
发送：$cmd=md_get485port1_sensor&index=0   
应答：$cmd=md_get485port1_sensor&status=[{\"model\":\"227_1\",\"sta\":\"-3\"}]
```

### 移除传感器指令字段说明
| 参数 | 说明 |示例 |备注 |
| - | - |- |- |
| model | 物模型加地址 | 227_1 | 217 为物模型，1 为地址 |
| del | 删除方式 | 1 | 0：删除全部，1：删除指定模型 |

### 移除传感器
```
发送：$cmd=md_del485port1_param&model=10066_2&del=1   
应答：$cmd=md_del485port1_param&result=succ
```



##  RS485-1 接口传感器参数页面



### 查询传感器参数信息
```
//index=0：查询第一个采集项
发送：$cmd=md_get485port1_param&model=10066_2&index=0    
应答：$cmd=md_get485port1_param&data={\"port1_param\":[{\"model\":\"10066_2\",\"num\":\"0\",\"swtoken\":\"200\",\"cmd\":\"03000A0002\",\"ratio\":\"1.0000\",\"dataformat\":\"14\",\"calctype\":\"0\",\"sensorlist\":\"-1\",\"kvalue\":\"1.0000000\",\"r0value\":\"0.0000000\",\"t0value\":\"0.0000000\",\"l0value\":\"0.0000000\",\"lvalue\":\"0.0000000\",\"bvalue\":\"0.0000000\",\"polyavalue\":\"-nan\",\"polybvalue\":\"-nan\",\"polycvalue\":\"-nan\",\"gateval\":\"0.00\",\"ngateval\":\"3\",\"uplimit\":\"10000.00\",\"lowlimit\":\"3000.00\",\"corrvalue\":\"0.00\",\"baud\":\"9600\",\"parity\":\"0\",\"databit\":\"8\",\"stopbit\":\"0\"}],\"index\":\"0\",\"indexnum\":\"1\"}

//index=1：查询第二个采集项
发送：$cmd=md_get485port1_param&model=10066_2&index=1
应答：$cmd=md_get485port1_param&data={\"port1_param\":[{\"model\":\"10066_2\",\"num\":\"1\",\"swtoken\":\"201\",\"cmd\":\"03000C0002\",\"ratio\":\"1.0000\",\"dataformat\":\"14\",\"calctype\":\"0\",\"sensorlist\":\"-1\",\"kvalue\":\"1.0000000\",\"r0value\":\"0.0000000\",\"t0value\":\"0.0000000\",\"l0value\":\"0.0000000\",\"lvalue\":\"0.0000000\",\"bvalue\":\"0.0000000\",\"polyavalue\":\"-nan\",\"polybvalue\":\"-nan\",\"polycvalue\":\"-nan\",\"gateval\":\"0.00\",\"ngateval\":\"3\",\"uplimit\":\"50.00\",\"lowlimit\":\"-300.00\",\"corrvalue\":\"0.00\",\"baud\":\"9600\",\"parity\":\"0\",\"databit\":\"8\",\"stopbit\":\"0\"}],\"index\":\"1\",\"indexnum\":\"1\"}
```

### 设置传感器参数
```
//index=0：设置采集项2
发送：$cmd=md_set485port1_param&model=10066_2&c_model=1&num=0&swtoken=200&cmd=03000A0002&ratio=1&dataformat=14&calctype=0&gateval=0&uplimit=10000&lowlimit=3000&corrvalue=0&ngateval=3&baud=9600&databit=8&parity=0&stopbit=0&mgbk=C4A3CAFD&egbk=46&sgbk=D5F1CFD2&kvalue=1&bvalue=0&r0value=0&t0value=0&l0value=0&lvalue=0
应答：$cmd=md_set485port1_param&result=succ

//index=1：设置水温采集项
发送：$cmd=md_set485port1_param&model=10066_2&c_model=1&num=1&swtoken=201&cmd=03000C0002&ratio=1&dataformat=14&calctype=0&gateval=0&uplimit=50&lowlimit=-300&corrvalue=0&ngateval=3&baud=9600&databit=8&parity=0&stopbit=0&mgbk=CEC2B6C8&egbk=A1E6&sgbk=D5F1CFD2&kvalue=1&bvalue=0&r0value=0&t0value=0&l0value=0&lvalue=0
应答：$cmd=md_set485port1_param&result=succ
```