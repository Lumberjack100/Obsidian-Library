# GNSS 分析工具

本目录包含专业的 GNSS 数据分析与可视化工具，所有工具基于 Web 技术构建，无需安装任何软件，直接在浏览器中运行。

## 📊 工具清单

### 1. GNSS 卫星星空图 (gnss-skyplot.html)

一个功能完整的 GNSS 数据分析工具，支持 RTCM3 二进制数据的解析、可视化和智能诊断。

#### 🎯 核心功能

##### 📡 数据解析
- **RTCM3 协议支持**: 完整实现 MSM4-MSM7 消息解析
  - GPS (消息类型 1074-1077)
  - 北斗/BDS (消息类型 1124-1127)
  - GLONASS (消息类型 1084-1087)
  - Galileo (消息类型 1094-1097)
- **CRC24Q 校验**: 确保数据完整性
- **大文件优化**: 支持分块解析，处理 MB 级数据不卡顿
- **进度反馈**: 实时显示解析进度

##### 📊 可视化展示
1. **卫星星空图**（简化版）
   - 按卫星系统分组（GPS/北斗/GLONASS/Galileo）
   - 按信号强度分层（>40dB / 30-40dB / <30dB）
   - 圆形布局，直观展示卫星分布
   - 暗色/亮色主题自适应

2. **信号强度柱状图**
   - 多频段信号可视化（L1/L2/L3）
   - 按卫星编号排列
   - 实时更新，动画过渡

3. **数据表格**
   - 详细卫星观测数据
   - 支持按系统筛选
   - 显示 PRN、CNR、信号质量等级

4. **信号强度趋势图**
   - 各系统随时间变化的折线图
   - 当前历元位置指示器
   - 可缩放、可交互

##### ⏱️ 时间轴功能
- **播放控制**: 播放/暂停、快进/快退（10帧步进）
- **速度调节**: 0.5x、1x、2x、5x、10x 倍速播放
- **时间轴滑块**: 拖动查看任意历元数据
- **时间戳显示**: 显示当前 GPS 时间和历元索引

##### 🔄 双文件对比模式
- **左右对比布局**: 同时显示基站和测站星空图
- **共视卫星识别**: 绿色环形高亮标记
- **统计分析**:
  - 共视卫星总数
  - 各系统共视卫星数量（GPS/北斗/GLONASS/Galileo）
- **RTK 可行性评估**: 自动判断是否满足固定解条件

##### 🩺 智能诊断系统
自动分析数据并生成诊断报告：

1. **卫星数量检测**
   - ✅ 充足（≥8颗）
   - ⚠️ 偏少（<8颗）
   - 提供优化建议

2. **信号强度分析**
   - ✅ 良好（平均 >40 dB-Hz）
   - ⚠️ 一般（30-40 dB-Hz）
   - ❌ 过弱（<30 dB-Hz）
   - 可能原因分析

3. **信号稳定性评估**
   - 检测信号波动（标准差分析）
   - 识别多路径效应
   - 检测间歇性遮挡

4. **系统多样性检查**
   - 评估多系统接收能力
   - 提供系统组合建议

5. **RTK 条件评估**（双文件模式）
   - ✅ 条件良好（共视≥8颗）
   - ⚠️ 条件一般（共视5-7颗）
   - ❌ 条件不足（共视<5颗）

#### 🚀 使用指南

##### 单文件模式（基础分析）

1. **打开工具**
   ```bash
   # 方式1: 直接双击打开 gnss-skyplot.html
   # 方式2: 命令行打开
   open gnss-skyplot.html  # macOS
   # 或
   start gnss-skyplot.html # Windows
   ```

2. **上传数据**
   - 点击或拖拽 `.bin` 文件到上传区域
   - 等待解析完成（通常几秒钟）

3. **查看分析**
   - 观察卫星分布情况
   - 查看信号强度统计
   - 阅读自动诊断建议

4. **时间轴操作**
   - 点击播放按钮观察信号变化
   - 拖动滑块快速定位
   - 调节播放速度

##### 双文件模式（RTK 分析）

1. **切换模式**
   - 点击顶部"对比模式"按钮

2. **上传数据**
   - 左侧上传基站数据（参考站）
   - 右侧上传测站数据（流动站）

3. **查看对比**
   - 观察共视卫星分布
   - 检查共视卫星数量统计
   - 评估 RTK 固定解条件

4. **诊断分析**
   - 查看自动生成的诊断卡片
   - 关注 RTK 条件评估结果
   - 根据建议优化设备部署

#### 🎨 界面特性

- **响应式设计**: 完美适配桌面/平板/手机
- **暗色模式**: 保护视力，点击右上角切换
- **流畅动画**: 平滑的过渡和交互反馈
- **无需安装**: 纯前端实现，开箱即用

#### 🔧 技术实现

##### 核心技术栈
- **HTML5**: 语义化结构
- **Vanilla JavaScript**: 无依赖，纯原生实现
- **Canvas API**: 高性能图形渲染
- **Tailwind CSS**: 现代化 UI 样式
- **Font Awesome**: 图标库

##### 关键算法

###### RTCM3 解析器
```javascript
class RTCM3Parser {
    // 帧头检测: 0xD3
    // CRC24Q 校验
    // MSM 消息解析
    // 位操作提取数据
}
```

- 支持 MSM4/5/6/7 消息类型
- 提取卫星 PRN、载噪比 CNR
- 历元时间解析
- 数据合并与排序

###### 星空图渲染
- 按系统分组布局（四象限）
- 按 CNR 值分层（三圈）
- 圆形分布算法
- 共视卫星高亮

###### 分析引擎
- 信号质量统计
- 波动检测（方差/标准差）
- 系统多样性评估
- RTK 条件判断逻辑

##### 性能优化
- **分块解析**: 大文件不阻塞 UI
- **Canvas 缓存**: 减少重绘开销
- **requestAnimationFrame**: 流畅动画
- **懒加载**: 按需渲染表格数据

#### 📋 数据要求

##### 支持的数据格式
- **文件扩展名**: `.bin`
- **协议标准**: RTCM 10403.3
- **消息类型**: MSM4/MSM5/MSM6/MSM7
- **系统支持**: GPS/BDS/GLO/GAL

##### 数据来源
- RTK 基站输出
- GNSS 接收机原始数据
- 各品牌设备（司南、华测、千寻等）

##### 数据质量建议
- **采样率**: 建议 1Hz（每秒一个历元）
- **观测时长**: 至少 10 分钟
- **环境条件**: 开阔天空，避免严重遮挡

#### 🐛 常见问题

**Q: 上传文件后没有反应？**
A: 请确认文件是标准的 RTCM3 格式 `.bin` 文件，检查浏览器控制台是否有错误提示。

**Q: 为什么星空图是简化版？**
A: RTCM3 MSM 消息不包含卫星仰角/方位角信息（需要星历计算），因此采用按信号强度分层的简化展示方式。

**Q: 双文件模式如何同步时间？**
A: 工具会自动使用历元索引对齐，建议基站和测站数据采集时间段重叠。

**Q: 支持实时数据流吗？**
A: 当前版本仅支持离线文件分析，实时流功能计划在未来版本添加。

**Q: 可以导出分析报告吗？**
A: 目前支持屏幕截图保存，PDF 导出功能在开发计划中。

#### 📈 未来规划

- [ ] 星历解算，实现精确星空图
- [ ] 实时数据流支持（WebSocket）
- [ ] 分析报告 PDF 导出
- [ ] 更多诊断规则（DOP 值、周跳检测）
- [ ] 数据质量评分系统
- [ ] 多语言支持（英文版）
- [ ] 移动端优化

#### 💡 使用建议

1. **项目现场诊断**
   - 部署设备后立即采集数据
   - 使用工具快速评估信号条件
   - 根据诊断结果调整天线位置

2. **RTK 基线解算前检查**
   - 验证共视卫星数量
   - 检查信号强度是否达标
   - 确认无严重多路径效应

3. **设备性能测试**
   - 对比不同时间段数据
   - 评估设备稳定性
   - 识别硬件故障迹象

4. **培训与教学**
   - 直观展示 GNSS 原理
   - 理解信号质量指标
   - 学习问题排查方法

## 🔗 相关资源

- **测试数据**: `../数据源/`
- **开发记录**: `../AI会话历史/`
- **提示词**: `../AI 提示词/`

## 📞 反馈与支持

如有问题或建议，欢迎通过以下方式反馈：
- 提交 Issue
- Pull Request
- 直接联系开发者

---

**最后更新**: 2025-12-04  
**版本**: v2.0  
**作者**: 伐木（AI 辅助开发）
